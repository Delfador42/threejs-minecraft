(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{tjUo:function(t,e,i){"use strict";i.r(e);var s=i("Womt"),o=i("ET6W");class n{constructor(t,e){this.cubeType=t,this.customCubeImages=e,this._images=[],this._materials=[],this._cubeSize=1,n.customCubeImages=[],n.DefaultCubeInfo={GrassDirt:{images:["../assets/img/blocks/grass_side.png","../assets/img/blocks/grass_side.png","../assets/img/blocks/grass_top_green.png","../assets/img/blocks/dirt.png","../assets/img/blocks/grass_side.png","../assets/img/blocks/grass_side.png"],material:{}},Cloud:{images:["../assets/img/blocks/grass_side.png","../assets/img/blocks/grass_side.png","../assets/img/blocks/grass_top_green.png","../assets/img/blocks/dirt.png","../assets/img/blocks/grass_side.png","../assets/img/blocks/grass_side.png"],material:{transparent:!0,opacity:.2}}}}initImages(){if(!this._images||0===this._images.length)if("Custom"===this.cubeType)this._images=this.customCubeImages;else{if(!n.DefaultCubeInfo[this.cubeType])throw"unknown cubeType";this._images=n.DefaultCubeInfo[this.cubeType].images}}initMaterials(){if(this._materials&&0!==this._materials.length)return;let t=new s.y;for(let e=0;e<6;++e){let i=t.load(this._images[e]);i.generateMipmaps=!1,i.magFilter=s.o,i.minFilter=s.o;let o={};n.DefaultCubeInfo[this.cubeType]&&(o=n.DefaultCubeInfo[this.cubeType].material),this._materials.push(new s.n({map:i,fog:!0,...o}))}}buildCube(t,e,i){t=t||0,e=e||0,i=i||0;let o=new s.l(new s.d(this._cubeSize,this._cubeSize,this._cubeSize),this._materials);return o.position.x=t+this._cubeSize/2,o.position.y=e+this._cubeSize/2,o.position.z=i+this._cubeSize/2,o.name="GrassCube("+t+","+e+","+i+")",o}create(t,e,i){return this.initImages(),this.initMaterials(),this.buildCube(t,e,i)}}var a=i("XFRQ"),h=i.n(a);class r{constructor(t){return r._instance,this.stats,r._instance?r._instance:(this.stats=new h.a,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="0px",this.stats.domElement.style.top="0px",document.getElementById(t).appendChild(this.stats.domElement),r._instance=this,this)}}i("RyHr");var c=i("sxfH");class l{constructor(t,e,i){return this.camera=t,l._instance?l._instance:(this.checkRay={lowX0Z0:void 0,lowX0Z1:void 0,lowX1Z0:void 0,lowX1Z1:void 0,highX0Z0:void 0,highX0Z1:void 0,highX1Z0:void 0,highX1Z1:void 0,Y0:[],Y1:[]},this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.preRuning=void 0,this.isRunning=!1,this.canJump=!1,this.objects=[],this.velocity=new s.A,this.direction=new s.A,this.worldOption={g:9},this.personOption={height:1.8,sightHeight:1.5,jumpHeight:1.4,speedWalk:5.7,speedRun:10,accelerateRateStart:.3,accelerateRateStop:.9},this.init(t,e,i),l._instance=this,l._instance)}init(t,e,i){this.objects=i,this.controls=new c.a(t,e);{let t=document.createElement("div");t.style.position="absolute",t.style.zIndex="1000",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",document.body.append(t),t.addEventListener("click",()=>{this.controls.lock()},!1),this.controls.addEventListener("lock",(function(){t.style.display="none"})),this.controls.addEventListener("unlock",(function(){t.style.display="block"}))}{let t=document.createElement("div");t.style.height="2px",t.style.width="20px",p(t),document.body.append(t);let e=document.createElement("div");e.style.height="20px",e.style.width="2px",p(e),document.body.append(e)}document.addEventListener("keydown",t=>{switch(t.keyCode){case 38:case 87:if(this.moveForward)break;this.preRuning?(this.isRunning=performance.now()-this.preRuning<=200,this.preRuning=performance.now()):this.preRuning=performance.now(),this.moveForward=!0;break;case 37:case 65:if(this.moveLeft)break;this.moveLeft=!0;break;case 40:case 83:if(this.moveBackward)break;this.moveBackward=!0;break;case 39:case 68:if(this.moveRight)break;this.moveRight=!0;break;case 32:this.canJump&&(this.velocity.y+=Math.sqrt(2*this.worldOption.g*7.74*this.personOption.jumpHeight)),this.canJump=!1}},!1),document.addEventListener("keyup",t=>{switch(t.keyCode){case 38:case 87:this.isRunning=!1,this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}},!1);for(let t=0;t<4;t++)this.checkRay.Y0.push(new s.s(new s.A,new s.A(0,-1,0),0,0));for(let t=0;t<4;t++)this.checkRay.Y1.push(new s.s(new s.A,new s.A(0,1,0),0,0))}update(t){t=t||.016,this.controls.isLocked||(this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1);{this.direction.z=Number(this.moveForward)-Number(this.moveBackward),this.direction.x=Number(this.moveRight)-Number(this.moveLeft),this.direction.normalize();let e=this.isRunning?this.personOption.speedRun:this.personOption.speedWalk;if(this.moveForward||this.moveBackward){let t=this.velocity.z+this.direction.z*e*this.personOption.accelerateRateStart;Math.abs(t)<e?this.velocity.z=t:this.velocity.z=this.direction.z*e}else this.velocity.z=Math.abs(this.velocity.z)>1?this.velocity.z*this.personOption.accelerateRateStop:0;if(this.moveLeft||this.moveRight){let t=this.velocity.x+this.direction.x*e*this.personOption.accelerateRateStart;Math.abs(t)<e?this.velocity.x=t:this.velocity.x=this.direction.x*e}else this.velocity.x=Math.abs(this.velocity.x)>1?this.velocity.x*this.personOption.accelerateRateStop:0;this.controls.moveRight(this.velocity.x*t),this.controls.moveForward(this.velocity.z*t)}{let e=void 0;for(let t=0;t<4;t++)this.checkRay.Y0[t].ray.origin.copy(this.controls.getObject().position);this.checkRay.Y0[0].ray.origin.x+=.4,this.checkRay.Y0[0].ray.origin.z-=.4,this.checkRay.Y0[1].ray.origin.x+=.4,this.checkRay.Y0[1].ray.origin.z+=.4,this.checkRay.Y0[2].ray.origin.x-=.4,this.checkRay.Y0[2].ray.origin.z+=.4,this.checkRay.Y0[3].ray.origin.x-=.4,this.checkRay.Y0[3].ray.origin.z-=.4;for(let t=0;t<4;t++){let i=this.checkRay.Y0[t].intersectObjects(this.objects);if(i.length>0){let t=i[0].point.y;e=Math.max(void 0===e?t:e,t)}}let i=void 0;for(let t=0;t<4;t++)this.checkRay.Y1[t].ray.origin.copy(this.controls.getObject().position);this.checkRay.Y1[0].ray.origin.x+=.4,this.checkRay.Y1[0].ray.origin.z-=.4,this.checkRay.Y1[1].ray.origin.x+=.4,this.checkRay.Y1[1].ray.origin.z+=.4,this.checkRay.Y1[2].ray.origin.x-=.4,this.checkRay.Y1[2].ray.origin.z+=.4,this.checkRay.Y1[3].ray.origin.x-=.4,this.checkRay.Y1[3].ray.origin.z-=.4;for(let t=0;t<4;t++){let e=this.checkRay.Y1[t].intersectObjects(this.objects);if(e.length>0){let t=e[0].point.y;i=Math.min(void 0===i?t:i,t)}}let s=this.controls.getObject().position.y+this.velocity.y*t;void 0!==i&&s>i-(this.personOption.height-this.personOption.sightHeight)&&(s=i-(this.personOption.height-this.personOption.sightHeight),this.velocity.y=0),void 0!==e?(this.controls.getObject().position.y=Math.max(e+this.personOption.sightHeight,s),s>e+this.personOption.sightHeight?this.velocity.y-=this.worldOption.g*Math.sqrt(t):(this.velocity.y=0,this.canJump=!0)):(this.controls.getObject().position.y=s,this.velocity.y-=this.worldOption.g*Math.sqrt(t))}this.controls.getObject().position.y<-2e3&&(this.controls.getObject().position.y=2e3,this.controls.getObject().position.x=0,this.controls.getObject().position.z=0)}initClickFunction(t){window.addEventListener("mousedown",e=>{let i=function(t,e,i){let o=new s.s,n=new s.z;return n.x=0,n.y=0,o.setFromCamera(n,i),o.intersectObjects(e)}(0,t,this.camera);if(i.length>0){let t=i[0].object;console.log("点击的对象："+t.name)}},!1)}}function p(t){t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%,-50%)",t.style.zIndex="1",t.style.fontSize="100%",t.style.fontWeight="bold",t.style.textAlign="center",t.style.verticalAlign="middle",t.style.lineHeight="10px",t.style.fontFamily='"Times New Roman",serif',t.style.backgroundColor="#E0E0E0"}function d(t,e,i,o,n,a,h){t=t||0,e=e||0,i=i||0,o=o||0,n=n||0,a=a||0,h=h||16711680;let r=new s.A(t,e,i),c=new s.A(o,n,a),l=new s.i;l.vertices.push(r),l.vertices.push(c);let p=new s.m({color:h});return new s.j(l,p)}!1===o.a.isWebGLAvailable()&&document.body.appendChild(o.a.getWebGLErrorMessage());let g,m,u,y,f=document.getElementById("canvas-frame"),b=f.offsetWidth,v=f.offsetHeight,w=8900331,k=function(){let t=new s.t;return t.name="SCENE",t.fog=new s.h(w,.001),function(e){e=e||1;let i=(new s.e).load(["./assets/img/1.png","./assets/img/2.png","./assets/img/3.png","./assets/img/4.png","./assets/img/5.png","./assets/img/6.png"]);if(1===e)t.background=new s.c(w);else if(2===e)t.background=i;else{let e=s.u.cube;e.uniforms.tCube.value=i;let o=new s.v({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms,depthWrite:!1,side:s.b}),n=new s.l(new s.d(1e6,1e6,1e6),o);t.add(n)}}(1),t}(),R=1,x=!0,_=1,z=.4;function O(){return Math.min(Math.max(z,R),_)}g=new s.a(16777215,O()),k.add(g),m=new s.q(45,b/v,.01,1e5),m.name="CAMERA",m.position.x=0,m.position.y=10,m.position.z=0,u=new s.B({antialias:!0}),u.name="RENDERER",u.shadowMap.enabled=!1,u.shadowMap.type=s.p,u.setSize(b,v),document.getElementById("canvas-frame").appendChild(u.domElement),u.setClearColor(16777215,1);let E=[];!function(){{let t=new l(m,u.domElement,E);t.initClickFunction(k.children),y=t}}(),function(t){let e=[];e.push(d(0,0,0,10,0,0,16711680)),e.push(d(0,0,0,0,10,0,65280)),e.push(d(0,0,0,0,0,10,255)),t&&t.add(...e)}(k),function(){let t=new n("GrassDirt");{let e=[];for(let t=-10;t<10;t++)for(let i=-10;i<10;i++)e.push([t,-1,i]);for(let t=0;t<5;t++)for(let i=0;i<5;i++)for(let s=0;s<5;s++)s>=t&&e.push([t-7,s-t,i-5]);let i=5;for(let t=0;t<i;t++)for(let s=t;s<2*i-t;s++)for(let o=t;o<2*i-t;o++)e.push([s-10,t,o+4]);for(let t=0;t<5;t++)for(let i=0;i<5;i++)2===t&&2===i||e.push([t,0,i]);e.push([0,1,0]),e.push([3,3,0]),e.push([2,3,0]),e.push([3,3,1]),e.push([2,3,1]),e.push([3,3,-1]),e.push([2,3,-1]),e.push([3,3,-2]),e.push([2,3,-2]),e.push([3,2,-3]),e.push([2,2,-3]),e.push([5,2,1]),e.push([4,2,1]),e.push([0,1,0]);for(let i of e){let e=t.create(i[0],i[1],i[2]);k.add(e),E.push(e)}}}();let C=performance.now();!function t(){requestAnimationFrame(t);let e=performance.now(),i=(e-C)/1e3;C=e,y.update(i),u.render(k,m),new r("canvas-frame").stats.update(i),g.intensity=O(),x?R>=z-(_-z)?R-=.002:x=!1:R<=_+(_-z)?R+=.002:R>1.5&&(x=!0)}(),window.onresize=function(){b=f.offsetWidth,v=f.offsetHeight,m.aspect=b/v,m.updateProjectionMatrix(),u.setSize(b,v)}}},[["tjUo",1,2]]]);
//# sourceMappingURL=index.ef9e886c37266c72be06.bundle.js.map