(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{tjUo:function(t,e,i){"use strict";i.r(e);var s=i("Womt"),o=i("ET6W"),n={enableShadow:!1};class h{constructor(t){if(h._instanceObj&&h._instanceObj[t.key])return h._instanceObj[t.key];this.cubeOptions=t,this._materials=[],this._materialsMap=[],this._geometry=void 0,this._cubeSize=1,this.initMaterials(),this.initGeometry(),h._instanceObj={[t.key]:this}}initGeometry(){this._geometry||(this._geometry=new s.d(this._cubeSize,this._cubeSize,this._cubeSize))}initMaterials(){if(!this.cubeOptions.key)throw'"key" in cubeType is undefined';if(this._materialsMap&&(this._materials=this._materialsMap[this.cubeOptions.key]),this._materials&&0!==this._materials.length)return;this._materials=[];let t=new s.A,e=[];for(let i of this.cubeOptions.images){let o=t.load(i);o.generateMipmaps=!0,o.minFilter=s.r,o.magFilter=s.q,e.push(o)}let i=[];for(let t of e)i.push(new s.p({map:t,vertexColors:s.D,side:s.g,fog:!0,...this.cubeOptions.materialParameters}));for(let t of this.cubeOptions.imageSet)this._materials.push(i[t]);this._materialsMap[this.cubeOptions.key]=this._materials}buildCube(t,e,i,o){o&&(this.cubeOptions=o,this.initMaterials()),t=t||0,e=e||0,i=i||0;let h=new s.n(this._geometry,this._materials);return h.receiveShadow=h.castShadow=n.enableShadow,h.position.x=t+this._cubeSize/2,h.position.y=e+this._cubeSize/2,h.position.z=i+this._cubeSize/2,h.name=this.cubeOptions.key+"("+t+","+e+","+i+")",h}}var r=i("XFRQ"),a=i.n(r);class c{constructor(t){if(c._instance)return c._instance;let e;return e=new a.a,e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.top="0px",document.getElementById(t).appendChild(e.domElement),c._instance=this,this.stats=e,this}}function l(t,e,i){return Math.min(Math.max(i,t),e)}function p(t,e,i){return Math.min(Math.max(i,t),e)/4}var g=i("RyHr");class y{constructor(t,e){return this.camera=t,y._instance?y._instance:(this.controls=new g.a(t,e),this.controls.dampingFactor=1,this.controls.enablePan=!1,y._instance=this,y._instance)}initClickFunction(t,e){window.addEventListener("mousedown",e=>{let i=function(t,e,i){let o=new s.u,n=new s.B;return n.x=t.clientX/window.innerWidth*2-1,n.y=-t.clientY/window.innerHeight*2+1,o.setFromCamera(n,i),o.intersectObjects(e)}(e,t,this.camera);if(i.length>0){let t=i[0].object;console.log("点击的对象："+t.name)}},!1)}}var d=i("sxfH"),m={grass:{key:"grass",images:["./assets/img/blocks/grass_side.png","./assets/img/blocks/grass_top_green.png","./assets/img/blocks/dirt.png"],imageSet:[0,0,1,2,0,0],materialParameters:{}},cobblestone:{key:"Cobblestone",images:["./assets/img/blocks/cobblestone.png"],imageSet:[0,0,0,0,0,0],materialParameters:{}},cobblestone_mossy:{key:"cobblestone_mossy",images:["./assets/img/blocks/cobblestone_mossy.png"],imageSet:[0,0,0,0,0,0],materialParameters:{}},stone:{key:"Stone",images:["./assets/img/blocks/stone.png"],imageSet:[0,0,0,0,0,0],materialParameters:{}},stone_slab:{key:"stone_slab",images:["./assets/img/blocks/stone_slab_side.png","./assets/img/blocks/stone_slab_top.png"],imageSet:[0,0,1,1,0,0],materialParameters:{}},planks_birch:{key:"planks_birch",images:["./assets/img/blocks/planks_birch.png"],imageSet:[0,0,0,0,0,0],materialParameters:{}}};class u{constructor(t,e,i,o){return this.camera=t,this.objects=i,this.scene=o,u._instance?u._instance:(this.checkRay={X0:[],X1:[],Z0:[],Z1:[],Y0:[],Y1:[]},this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.preRuning=void 0,this.isRunning=!1,this.canJump=!1,this.velocity=new s.C,this.direction=new s.C,this.worldOption={g:9},this.personOption={height:1.8,sightHeight:1.5,jumpHeight:1.4,speedWalk:5.7,speedRun:10,accelerateRateStart:.3,accelerateRateStop:.8,thickness:.6},this.init(t,e),u._instance=this,u._instance)}init(t,e){this.controls=new d.a(t,e);{let t=document.createElement("div");t.style.position="absolute",t.style.zIndex="100",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.id="blocker",document.body.append(t),t.addEventListener("click",()=>{this.controls.lock()},!1),this.controls.addEventListener("lock",(function(){t.style.display="none"})),this.controls.addEventListener("unlock",(function(){t.style.display="block"}))}{let t=document.createElement("div");t.style.height="2px",t.style.width="20px",k(t),document.body.append(t);let e=document.createElement("div");e.style.height="20px",e.style.width="2px",k(e),document.body.append(e)}document.addEventListener("keydown",t=>{switch(t.keyCode){case 38:case 87:if(this.moveForward)break;this.preRuning?(this.isRunning=performance.now()-this.preRuning<=200,this.preRuning=performance.now()):this.preRuning=performance.now(),this.moveForward=!0;break;case 37:case 65:if(this.moveLeft)break;this.moveLeft=!0;break;case 40:case 83:if(this.moveBackward)break;this.moveBackward=!0;break;case 39:case 68:if(this.moveRight)break;this.moveRight=!0;break;case 32:this.canJump&&(this.velocity.y+=Math.sqrt(2*this.worldOption.g*7.74*this.personOption.jumpHeight)),this.canJump=!1}},!1),document.addEventListener("keyup",t=>{switch(t.keyCode){case 38:case 87:this.isRunning=!1,this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}},!1);for(let t=0;t<6;t++)this.checkRay.X0.push(new s.u(new s.C,new s.C(-1,0,0),0,0));for(let t=0;t<6;t++)this.checkRay.X1.push(new s.u(new s.C,new s.C(1,0,0),0,0));for(let t=0;t<6;t++)this.checkRay.Z0.push(new s.u(new s.C,new s.C(0,0,-1),0,0));for(let t=0;t<6;t++)this.checkRay.Z1.push(new s.u(new s.C,new s.C(0,0,1),0,0));for(let t=0;t<4;t++)this.checkRay.Y0.push(new s.u(new s.C,new s.C(0,-1,0),0,0));for(let t=0;t<4;t++)this.checkRay.Y1.push(new s.u(new s.C,new s.C(0,1,0),0,0));this.initClickFunction()}update(t){console.log(this.objects.length),t=t||.016,this.controls.isLocked||(this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1);{this.direction.z=Number(this.moveForward)-Number(this.moveBackward),this.direction.x=Number(this.moveRight)-Number(this.moveLeft),this.direction.normalize();let e=this.isRunning?this.personOption.speedRun:this.personOption.speedWalk;if(this.moveForward||this.moveBackward){let t=this.velocity.z+this.direction.z*e*this.personOption.accelerateRateStart;Math.abs(t)<e?this.velocity.z=t:this.velocity.z=this.direction.z*e}else this.velocity.z=Math.abs(this.velocity.z)>1?this.velocity.z*this.personOption.accelerateRateStop:0;if(this.moveLeft||this.moveRight){let t=this.velocity.x+this.direction.x*e*this.personOption.accelerateRateStart;Math.abs(t)<e?this.velocity.x=t:this.velocity.x=this.direction.x*e}else this.velocity.x=Math.abs(this.velocity.x)>1?this.velocity.x*this.personOption.accelerateRateStop:0;let i=this.controls.getObject().position.x,s=this.controls.getObject().position.z;this.controls.moveForward(this.velocity.z*t),this.controls.moveRight(this.velocity.x*t);{let t=void 0;{for(let t=0;t<6;t++)this.checkRay.Z0[t].ray.origin.copy(this.controls.getObject().position),this.checkRay.Z0[t].ray.origin.x=i;let e=this.personOption.thickness/2;this.checkRay.Z0[0].ray.origin.x+=e,this.checkRay.Z0[0].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.Z0[1].ray.origin.x-=e,this.checkRay.Z0[1].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.Z0[2].ray.origin.x+=e,this.checkRay.Z0[2].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.Z0[3].ray.origin.x-=e,this.checkRay.Z0[3].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.Z0[4].ray.origin.x+=e,this.checkRay.Z0[4].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.05,this.checkRay.Z0[5].ray.origin.x-=e,this.checkRay.Z0[5].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.05;for(let e=0;e<6;e++){let i=this.checkRay.Z0[e].intersectObjects(this.objects);if(i.length>0){let e=i[0].point.z;t=Math.max(void 0===t?e:t,e)}}}let e=void 0;{for(let t=0;t<6;t++)this.checkRay.Z1[t].ray.origin.copy(this.controls.getObject().position),this.checkRay.Z1[t].ray.origin.x=i;let t=this.personOption.thickness/2;this.checkRay.Z1[0].ray.origin.x+=t,this.checkRay.Z1[0].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.Z1[1].ray.origin.x-=t,this.checkRay.Z1[1].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.Z1[2].ray.origin.x+=t,this.checkRay.Z1[2].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.Z1[3].ray.origin.x-=t,this.checkRay.Z1[3].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.Z1[4].ray.origin.x+=t,this.checkRay.Z1[4].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.05,this.checkRay.Z1[5].ray.origin.x-=t,this.checkRay.Z1[5].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.05;for(let t=0;t<6;t++){let i=this.checkRay.Z1[t].intersectObjects(this.objects);if(i.length>0){let t=i[0].point.z;e=Math.min(void 0===e?t:e,t)}}}let s=this.controls.getObject().position.z;s=Math.max(void 0===t?s:t+this.personOption.thickness/2+.001,s),s=Math.min(void 0===e?s:e-this.personOption.thickness/2-.001,s),this.controls.getObject().position.z=s}{let t=void 0;{for(let t=0;t<6;t++)this.checkRay.X0[t].ray.origin.copy(this.controls.getObject().position),this.checkRay.X0[t].ray.origin.z=s;let e=this.personOption.thickness/2;this.checkRay.X0[0].ray.origin.z+=e,this.checkRay.X0[0].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.X0[1].ray.origin.z-=e,this.checkRay.X0[1].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.X0[2].ray.origin.z+=e,this.checkRay.X0[2].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.X0[3].ray.origin.z-=e,this.checkRay.X0[3].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.X0[4].ray.origin.z+=e,this.checkRay.X0[4].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.051,this.checkRay.X0[5].ray.origin.z-=e,this.checkRay.X0[5].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.051;for(let e=0;e<6;e++){let i=this.checkRay.X0[e].intersectObjects(this.objects);if(i.length>0){let e=i[0].point.x;t=Math.max(void 0===t?e:t,e)}}}let e=void 0;{for(let t=0;t<6;t++)this.checkRay.X1[t].ray.origin.copy(this.controls.getObject().position),this.checkRay.X1[t].ray.origin.z=s;let t=this.personOption.thickness/2;this.checkRay.X1[0].ray.origin.z+=t,this.checkRay.X1[0].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.X1[1].ray.origin.z-=t,this.checkRay.X1[1].ray.origin.y-=this.personOption.sightHeight-.05,this.checkRay.X1[2].ray.origin.z+=t,this.checkRay.X1[2].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.X1[3].ray.origin.z-=t,this.checkRay.X1[3].ray.origin.y-=this.personOption.sightHeight-this.personOption.height/2,this.checkRay.X1[4].ray.origin.z+=t,this.checkRay.X1[4].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.05,this.checkRay.X1[5].ray.origin.z-=t,this.checkRay.X1[5].ray.origin.y+=this.personOption.height-this.personOption.sightHeight-.05;for(let t=0;t<6;t++){let i=this.checkRay.X1[t].intersectObjects(this.objects);if(i.length>0){let t=i[0].point.x;e=Math.min(void 0===e?t:e,t)}}}let i=this.controls.getObject().position.x;i=Math.max(void 0===t?i:t+this.personOption.thickness/2+.001,i),i=Math.min(void 0===e?i:e-this.personOption.thickness/2-.001,i),this.controls.getObject().position.x=i}}{let e=void 0;{for(let t=0;t<4;t++)this.checkRay.Y0[t].ray.origin.copy(this.controls.getObject().position);let t=this.personOption.thickness/2;this.checkRay.Y0[0].ray.origin.x+=t,this.checkRay.Y0[0].ray.origin.z-=t,this.checkRay.Y0[1].ray.origin.x+=t,this.checkRay.Y0[1].ray.origin.z+=t,this.checkRay.Y0[2].ray.origin.x-=t,this.checkRay.Y0[2].ray.origin.z+=t,this.checkRay.Y0[3].ray.origin.x-=t,this.checkRay.Y0[3].ray.origin.z-=t;for(let t=0;t<4;t++){let i=this.checkRay.Y0[t].intersectObjects(this.objects);if(i.length>0){let t=i[0].point.y;e=Math.max(void 0===e?t:e,t)}}}let i=void 0;{for(let t=0;t<4;t++)this.checkRay.Y1[t].ray.origin.copy(this.controls.getObject().position);let t=this.personOption.thickness/2-.01;this.checkRay.Y1[0].ray.origin.x+=t,this.checkRay.Y1[0].ray.origin.z-=t,this.checkRay.Y1[1].ray.origin.x+=t,this.checkRay.Y1[1].ray.origin.z+=t,this.checkRay.Y1[2].ray.origin.x-=t,this.checkRay.Y1[2].ray.origin.z+=t,this.checkRay.Y1[3].ray.origin.x-=t,this.checkRay.Y1[3].ray.origin.z-=t;for(let t=0;t<4;t++){let e=this.checkRay.Y1[t].intersectObjects(this.objects);if(e.length>0){let t=e[0].point.y;i=Math.min(void 0===i?t:i,t)}}}let s=this.controls.getObject().position.y+this.velocity.y*t;void 0!==i&&s>i-(this.personOption.height-this.personOption.sightHeight)&&(s=i-(this.personOption.height-this.personOption.sightHeight),this.velocity.y=0),void 0!==e?(s=Math.max(e+this.personOption.sightHeight,s),s===e+this.personOption.sightHeight?(this.velocity.y=0,this.canJump=!0):this.velocity.y-=this.worldOption.g*Math.sqrt(t)):this.velocity.y-=this.worldOption.g*Math.sqrt(t),this.controls.getObject().position.y=s}this.controls.getObject().position.y<-500&&(this.velocity.y=0,this.controls.getObject().position.y=500,this.controls.getObject().position.x=0,this.controls.getObject().position.z=0)}initClickFunction(){window.addEventListener("mouseup",t=>{t.button}),window.addEventListener("mousedown",t=>{let e=function(t,e){let i=new s.u,o=new s.B;return o.x=0,o.y=0,i.setFromCamera(o,e),i.intersectObjects(t)}(this.scene.children,this.camera);if(e.length>0&&(console.log("点击对象【"+e[0].object.name+"】",e[0]),e[0]&&e[0].distance<=10&&e[0].face&&e[0].face.normal&&e[0].object&&e[0].object.position)){let i=e[0].face.normal,s=e[0].object.position,o={x:i.x+s.x-.5,y:i.y+s.y-.5,z:i.z+s.z-.5};if(2===t.button){let t=new h(m.grass).buildCube(o.x,o.y,o.z);this.scene.add(t),this.objects.push(t)}else if(0===t.button){console.log(e[0].object,this.scene.getObjectByName(e[0].object.name));let t=this.objects.findIndex(t=>t.id===e[0].object.id);t>=0&&this.objects.splice(t,1),this.scene.remove(this.scene.getObjectById(e[0].object.id))}}},!1)}}function k(t){t.style.position="fixed",t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%,-50%)",t.style.zIndex="1",t.style.fontSize="100%",t.style.fontWeight="bold",t.style.textAlign="center",t.style.verticalAlign="middle",t.style.lineHeight="10px",t.style.fontFamily='"Times New Roman",serif',t.style.backgroundColor="#E0E0E0"}function b(t,e,i,o,n,h,r){t=t||0,e=e||0,i=i||0,o=o||0,n=n||0,h=h||0,r=r||16711680;let a=new s.C(t,e,i),c=new s.C(o,n,h),l=new s.k;l.vertices.push(a),l.vertices.push(c);let p=new s.o({color:r});return new s.l(l,p)}o.a.isWebGLAvailable()||document.body.appendChild(o.a.getWebGLErrorMessage());let f,w=document.getElementById("canvas-frame"),R=function(){let t=new s.v;return t.name="SCENE",t.fog=new s.j(8900331,.005),function(e){e=e||1;let i=(new s.e).load(["./assets/img/1.png","./assets/img/2.png","./assets/img/3.png","./assets/img/4.png","./assets/img/5.png","./assets/img/6.png"]);if(1===e)t.background=new s.c(8900331);else if(2===e)t.background=i;else{let e=s.w.cube;e.uniforms.tCube.value=i;let o=new s.x({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms,depthWrite:!1,side:s.b}),n=new s.n(new s.d(1e6,1e6,1e6),o);t.add(n)}}(1),t}(),O=function(){let t=new s.a;return t.castShadow=!1,t.color=(new s.c).setHex(16777215),t.intensity=l(),t}();R.add(O),n.enableShadow&&(f=function(){let t=new s.f;return t.castShadow=n.enableShadow,t.color=(new s.c).setHex(16777215),t.intensity=p(),t.shadow.radius=512,t.position.x=10,t.position.y=-10,t.position.z=10,t}(),R.add(f));let v=function(){let t=new s.s;return t.name="CAMERA",t.fov=45,t.near=.1,t.far=1e3,t.position.x=0,t.position.y=10,t.position.z=0,t}();v.aspect=w.offsetWidth/w.offsetHeight,v.updateProjectionMatrix(),R.add(v);let x=function(){let t=new s.E;return t.name="RENDERER",t.antialias=!0,t.shadowMap.enabled=n.enableShadow,t.setClearColor(16777215,1),t}();x.setSize(w.offsetWidth,w.offsetHeight),x.setPixelRatio(window.devicePixelRatio),document.getElementById("canvas-frame").appendChild(x.domElement);let z=[],j=function(t,e,i,s,o){let n;switch(t){case"ShowOrbitControl":let t=new y(i,s.domElement);t.initClickFunction(e.children),n=t.controls;break;case"MCFirstPersonControl":n=new u(i,s.domElement,o,e)}return n}("MCFirstPersonControl",R,v,x,z);!function(t){let e=[];e.push(b(0,0,0,1,0,0,16711680)),e.push(b(0,0,0,0,1,0,65280)),e.push(b(0,0,0,0,0,1,255)),t&&t.add(...e)}(R);let _={current:1,low:.4,high:1,becomeHigher:!0};!function(){let t=new h(m.grass);{let e=[],i=10;for(let t=-i;t<i;t++)for(let s=-i;s<i;s++)e.push([t,-1,s]);for(let t=0;t<5;t++)for(let i=0;i<5;i++)for(let s=0;s<5;s++)s>=t&&e.push([t-7,s-t,i-7]);{let t=4;for(let i=0;i<t;i++)for(let s=i;s<2*t-i;s++)for(let o=i;o<2*t-i;o++)e.push([s-5,i,o+1])}for(let t=0;t<5;t++)for(let i=0;i<5;i++)2===t&&2===i||e.push([t,0,i-5]);e.push([0,1,-5]),e.push([3,3,-5]),e.push([2,3,-5]),e.push([3,3,-4]),e.push([2,3,-4]),e.push([3,3,-6]),e.push([2,3,-6]),e.push([3,3,-7]),e.push([2,3,-7]),e.push([3,2,-8]),e.push([2,2,-8]),e.push([5,2,-4]),e.push([4,2,-4]),e.push([0,1,-5]),e.push([10,1,0,m.cobblestone]),e.push([10,1,-2,m.cobblestone_mossy]),e.push([10,1,-4,m.stone]),e.push([10,1,-6,m.stone_slab]),e.push([10,1,-8,m.planks_birch]),e.push([0,10,0,m.grass]);for(let i of e){let e=t.buildCube(i[0],i[1],i[2],i[3]);R.add(e),z.push(e)}}}();let H=performance.now();!function t(){requestAnimationFrame(t);let e=performance.now(),i=(e-H)/1e3;H=e,j.update(),x.render(R,v),new c("canvas-frame").stats.update(i),function(){if(O.intensity=l(_.current,_.high,_.low),n.enableShadow&&(f.intensity=p(_.current,_.high,_.low)),_.becomeHigher){_.current>=_.low-(_.high-_.low)?_.current-=.002:_.becomeHigher=!1}else _.current<=_.high+(_.high-_.low)?_.current+=.002:_.current>1.5&&(_.becomeHigher=!0)}()}(),window.onresize=()=>{v.aspect=w.offsetWidth/w.offsetHeight,v.updateProjectionMatrix(),x.setSize(w.offsetWidth,w.offsetHeight)},window.onload=()=>{!function(){let t,e=0,i=["./assets/sound/calm1.ogg","./assets/sound/calm2.ogg","./assets/sound/calm3.ogg","./assets/sound/hal1.ogg","./assets/sound/hal2.ogg","./assets/sound/hal3.ogg","./assets/sound/hal4.ogg"];t=new Audio,t.preload="true",t.controls=!0,t.autoplay=!0,t.hidden=!0,t.style.display="none",t.style.position="fixed",t.style.top="0",t.style.right="0",t.style.zIndex="101",t.loop=!1,t.src=i[e],t.addEventListener("ended",(function(){e++,e>=i.length&&(e=0);t.src=i[e],t.play()}),!1),document.addEventListener("click",(function e(){t.play(),document.removeEventListener("click",e,!1)}),!1),document.body.appendChild(t)}()}}},[["tjUo",1,2]]]);
//# sourceMappingURL=index.e29162b6014a3e97cfa5.bundle.js.map